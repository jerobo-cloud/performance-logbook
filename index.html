<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Performance Logbook</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#0b0f14" />

  <style>
    :root{
      --bg: #0b0f14;
      --card: rgba(255,255,255,0.06);
      --card2: rgba(255,255,255,0.085);
      --stroke: rgba(255,255,255,0.10);
      --text: rgba(255,255,255,0.92);
      --muted: rgba(255,255,255,0.60);
      --faint: rgba(255,255,255,0.42);
      --accent: #2f81f7;
      --good: #3fb950;
      --bad: #ff5d5d;
      --shadow: 0 14px 34px rgba(0,0,0,0.35);
      --r: 18px;
      --r2: 14px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: var(--sans);
      color: var(--text);
      background:
        radial-gradient(1200px 700px at 20% -10%, rgba(47,129,247,0.22), transparent 60%),
        radial-gradient(900px 600px at 90% 10%, rgba(63,185,80,0.14), transparent 55%),
        linear-gradient(180deg, #070a11 0%, var(--bg) 25%, #070a11 100%);
    }
    .wrap{
      max-width: 880px;
      margin: 0 auto;
      padding: 16px 14px 40px;
    }

    /* Header */
    .hdr{
      display:flex;
      justify-content:space-between;
      align-items:flex-end;
      gap: 12px;
      padding: 4px 2px 10px;
    }
    .hdr h1{
      margin:0;
      font-size: 22px;
      letter-spacing: -0.02em;
      line-height: 1.1;
      font-weight: 800;
    }
    .sub{
      margin-top: 4px;
      font-size: 12px;
      color: var(--muted);
    }
    .stamp{
      display:flex;
      flex-direction:column;
      align-items:flex-end;
      gap: 4px;
      min-width: 120px;
    }
    .pill{
      display:inline-flex;
      align-items:center;
      gap: 8px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,0.05);
      font-size: 12px;
      color: var(--muted);
      white-space:nowrap;
    }
    .dot{
      width: 8px; height: 8px;
      border-radius: 50%;
      background: var(--good);
      box-shadow: 0 0 0 3px rgba(63,185,80,0.15);
    }
    .ver{
      font-family: var(--mono);
      font-size: 11px;
      color: var(--faint);
    }

    /* Layout */
    .grid{
      display:grid;
      grid-template-columns: 1.25fr 0.75fr;
      gap: 12px;
    }
    @media (max-width: 860px){
      .grid{ grid-template-columns: 1fr; }
    }

    /* Cards */
    .card{
      background: var(--card);
      border: 1px solid var(--stroke);
      border-radius: var(--r);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .card-h{
      display:flex;
      justify-content:space-between;
      align-items:baseline;
      gap: 10px;
      padding: 12px 12px 9px;
      border-bottom: 1px solid rgba(255,255,255,0.08);
      background: linear-gradient(180deg, rgba(255,255,255,0.05), transparent);
    }
    .card-h h2{
      margin:0;
      font-size: 13px;
      letter-spacing: 0.01em;
      color: rgba(255,255,255,0.86);
      font-weight: 750;
    }
    .hint{
      color: var(--faint);
      font-size: 12px;
      white-space:nowrap;
    }
    .card-b{ padding: 12px; }

    /* Import */
    textarea{
      width: 100%;
      min-height: 168px; /* A2: slightly shorter */
      resize: vertical;
      border-radius: var(--r2);
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(2,6,23,0.70);
      color: var(--text);
      padding: 10px 10px;
      font-family: var(--mono);
      font-size: 13px;
      line-height: 1.35;
      outline: none;
    }
    textarea:focus{
      border-color: rgba(47,129,247,0.55);
      box-shadow: 0 0 0 4px rgba(47,129,247,0.14);
    }
    .actions{
      margin-top: 10px;
      display:flex;
      gap: 10px;
      align-items:center;
      flex-wrap:wrap;
    }
    button{
      border:none;
      background: var(--accent);
      color:white;
      padding: 9px 12px;
      border-radius: 12px;
      font-weight: 750;
      font-size: 13px;
      letter-spacing: 0.01em;
    }
    button:active{ transform: translateY(1px); }
    .ghost{
      background: rgba(255,255,255,0.06);
      color: rgba(255,255,255,0.90);
      border: 1px solid rgba(255,255,255,0.10);
    }
    .status{
      font-size: 12px;
      color: var(--muted);
      font-weight: 650;
    }
    .status.good{ color: rgba(63,185,80,0.95); }
    .status.bad{ color: rgba(255,93,93,0.95); }
    .tip{
      margin-top: 8px;
      font-size: 12px;
      color: var(--faint);
      line-height: 1.35;
    }
    code{
      font-family: var(--mono);
      font-size: 12px;
      padding: 1px 6px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(255,255,255,0.05);
      color: rgba(255,255,255,0.85);
    }

    /* Today */
    .todayTop{
      display:flex;
      justify-content:space-between;
      align-items:baseline;
      gap: 10px;
      margin-bottom: 8px;
    }
    .todayTitle{
      font-size: 13px;
      font-weight: 780;
      color: rgba(255,255,255,0.86);
    }
    .todayDate{
      font-family: var(--mono);
      font-size: 12px;
      color: var(--faint);
    }
    .kpis{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-bottom: 10px;
    }
    .kpi{
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(255,255,255,0.05);
      border-radius: 16px;
      padding: 10px 10px 9px;
    }
    .kpiVal{
      font-size: 20px;   /* A2: slightly smaller than A1 */
      font-weight: 820;
      letter-spacing: -0.02em;
      line-height: 1.1;
    }
    .kpiLab{
      margin-top: 3px;
      font-size: 11px;
      color: var(--muted);
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap: 8px;
    }
    .unit{ color: var(--faint); }

    /* Chips */
    .chips{
      display:flex;
      flex-wrap:wrap;
      gap: 8px;
    }
    .chip{
      display:inline-flex;
      align-items:center;
      gap: 8px;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(255,255,255,0.04);
      font-size: 12px;
      color: rgba(255,255,255,0.86);
      max-width: 100%;
    }
    .chip .meta{
      color: var(--muted);
      white-space:nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
      max-width: 100%;
    }
    .chip .tag{
      font-family: var(--mono);
      font-size: 11px;
      color: rgba(255,255,255,0.82);
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.10);
      padding: 2px 6px;
      border-radius: 999px;
      white-space:nowrap;
    }

    /* Bench */
    .benchGrid{
      display:grid;
      grid-template-columns: 1.1fr 0.9fr;
      gap: 10px;
      align-items:stretch;
    }
    @media (max-width: 420px){
      .benchGrid{ grid-template-columns: 1fr; }
    }
    .benchBig{
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(255,255,255,0.05);
      border-radius: 16px;
      padding: 10px;
    }
    .benchBig .lab{
      font-size: 11px;
      color: var(--muted);
    }
    .benchBig .val{
      margin-top: 4px;
      font-size: 24px;
      font-weight: 860;
      letter-spacing: -0.02em;
    }
    .milestones{
      display:flex;
      flex-direction:column;
      gap: 8px;
    }
    .ms{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap: 10px;
      padding: 10px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(255,255,255,0.04);
    }
    .ms .left{
      display:flex;
      flex-direction:column;
      gap: 2px;
      min-width: 0;
    }
    .ms .name{
      font-weight: 780;
      font-size: 12px;
      color: rgba(255,255,255,0.88);
    }
    .ms .req{
      font-size: 11px;
      color: var(--muted);
    }
    .ms .right{
      font-family: var(--mono);
      font-size: 11px;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(255,255,255,0.05);
      white-space:nowrap;
    }
    .ok{ color: rgba(63,185,80,0.98); border-color: rgba(63,185,80,0.35) !important; background: rgba(63,185,80,0.12) !important; }
    .no{ color: rgba(255,93,93,0.98); border-color: rgba(255,93,93,0.35) !important; background: rgba(255,93,93,0.10) !important; }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="hdr">
      <div>
        <h1>Performance Logbook</h1>
        <div class="sub">Paste your nightly snapshot, tap Import, and review today’s signal.</div>
      </div>
      <div class="stamp">
        <div class="pill"><span class="dot"></span><span>Live</span></div>
        <div class="ver">A2 • v0.2</div>
      </div>
    </div>

    <div class="grid">
      <!-- Import -->
      <div class="card">
        <div class="card-h">
          <h2>Import</h2>
          <div class="hint">(@day / @run / @lift)</div>
        </div>
        <div class="card-b">
          <textarea id="input" placeholder="@day 2026-02-21
weight: 182.0
calories: 2100
protein: 155

@run
type: easy
distance_mi: 3.5
duration: 38:00
avg_pace: 10:51
avg_hr: 153

@lift
bench_press: 200x5, 185x8, 175x10"></textarea>

          <div class="actions">
            <button onclick="importSnapshot()">Import</button>
            <button class="ghost" onclick="loadSample()">Load sample</button>
            <span id="status" class="status"></span>
          </div>

          <div class="tip">
            Tip: use <code>na</code> for missing values. Bench milestones require <b>5+ reps</b>.
          </div>
        </div>
      </div>

      <!-- Today -->
      <div class="card">
        <div class="card-h">
          <h2>Today</h2>
          <div class="hint" id="todayDate">—</div>
        </div>
        <div class="card-b">
          <div class="kpis">
            <div class="kpi">
              <div class="kpiVal" id="weight">—</div>
              <div class="kpiLab"><span>Weight</span><span class="unit">lbs</span></div>
            </div>
            <div class="kpi">
              <div class="kpiVal" id="calories">—</div>
              <div class="kpiLab"><span>Calories</span><span class="unit">kcal</span></div>
            </div>
            <div class="kpi">
              <div class="kpiVal" id="protein">—</div>
              <div class="kpiLab"><span>Protein</span><span class="unit">g</span></div>
            </div>
          </div>

          <div class="chips" id="chips"></div>
        </div>
      </div>

      <!-- Bench -->
      <div class="card">
        <div class="card-h">
          <h2>Bench Goals</h2>
          <div class="hint">1RM + milestones</div>
        </div>
        <div class="card-b">
          <div class="benchGrid">
            <div class="benchBig">
              <div class="lab">Estimated 1RM</div>
              <div class="val" id="est1rm">—</div>
              <div class="lab" style="margin-top:6px;color:var(--faint)">Epley formula</div>
            </div>
            <div class="milestones">
              <div class="ms">
                <div class="left">
                  <div class="name">200 lb top set</div>
                  <div class="req">5+ reps required</div>
                </div>
                <div class="right" id="m200">—</div>
              </div>
              <div class="ms">
                <div class="left">
                  <div class="name">225 lb top set</div>
                  <div class="req">5+ reps required</div>
                </div>
                <div class="right" id="m225">—</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- (Room for future: history / trends) -->
      <div class="card">
        <div class="card-h">
          <h2>Next</h2>
          <div class="hint">History + trends</div>
        </div>
        <div class="card-b" style="color:var(--muted);font-size:12px;line-height:1.45">
          Next step is saving each day so you can see progress over time (weight trend, pace@HR progress, and lift performance).
        </div>
      </div>
    </div>
  </div>

<script>
  function epley(w, r) {
    return Math.round(w * (1 + r / 30));
  }

  // treat "na" (case-insensitive) as missing
  function cleanValue(v) {
    if (v == null) return null;
    const s = String(v).trim();
    if (s === '') return null;
    if (s.toLowerCase() === 'na') return null;
    return s;
  }

  function setStatus(msg, type){
    const el = document.getElementById('status');
    el.textContent = msg || '';
    el.className = 'status ' + (type || '');
  }

  function importSnapshot() {
    try{
      const text = document.getElementById('input').value;
      const lines = text.split('\n').map(l => l.trim()).filter(Boolean);

      let section = null;
      const day = {};
      const run = {};
      const lifts = {};

      for (const line of lines) {
        if (line.startsWith('@')) {
          // "@day 2026-02-21" -> "day"
          const header = line.slice(1).trim();
          section = header.split(/\s+/)[0].toLowerCase();
          continue;
        }

        const idx = line.indexOf(':');
        if (idx === -1) continue;

        const key = line.slice(0, idx).trim();
        const raw = line.slice(idx + 1).trim();
        const val = cleanValue(raw);

        if (!key) continue;
        if (val === null) continue;

        if (section === 'day') day[key] = val;
        if (section === 'run') run[key] = val;
        if (section === 'lift') lifts[key] = val;
      }

      // Date: prefer the @day header date if present
      const dateMatch = text.match(/@day\s+(\d{4}-\d{2}-\d{2})/);
      const date = dateMatch ? dateMatch[1] : (day.date ?? '—');
      document.getElementById('todayDate').textContent = date;

      // KPIs (exact strings, no rounding)
      document.getElementById('weight').textContent = day.weight ?? '—';
      document.getElementById('calories').textContent = day.calories ?? '—';
      document.getElementById('protein').textContent = day.protein ?? '—';

      // Chips (Run + Lift)
      const chips = document.getElementById('chips');
      chips.innerHTML = '';

      // Run chip (exact avg_pace)
      if (run.distance_mi || run.avg_pace || run.avg_hr) {
        const type = run.type ?? 'run';
        const dist = run.distance_mi ? `${run.distance_mi} mi` : '';
        const pace = run.avg_pace ? `${run.avg_pace}` : '';
        const hr = run.avg_hr ? `${run.avg_hr}` : '';
        const metaParts = [type, dist].filter(Boolean).join(' • ');
        const chip = document.createElement('div');
        chip.className = 'chip';
        chip.innerHTML =
          `<span>Run</span>
           <span class="meta">${metaParts}${pace ? ' • pace ' + pace : ''}</span>
           ${hr ? `<span class="tag">HR ${hr}</span>` : ''}`;
        chips.appendChild(chip);
      }

      // Lift chip
      const liftKeys = Object.keys(lifts);
      if (liftKeys.length) {
        const chip = document.createElement('div');
        chip.className = 'chip';
        const list = liftKeys.join(', ');
        chip.innerHTML =
          `<span>Lift</span>
           <span class="meta">${list}</span>`;
        chips.appendChild(chip);
      }

      // Bench goals
      let est1RM = null;
      let hit200 = false;
      let hit225 = false;

      if (lifts.bench_press) {
        const sets = lifts.bench_press.split(',')
          .map(s => s.trim())
          .map(s => {
            const m = s.match(/^(\d+)\s*x\s*(\d+)$/i);
            if (!m) return null;
            return { w: Number(m[1]), r: Number(m[2]) };
          })
          .filter(Boolean);

        if (sets.length) {
          est1RM = Math.max(...sets.map(s => epley(s.w, s.r)));
          hit200 = sets.some(s => s.w >= 200 && s.r >= 5);
          hit225 = sets.some(s => s.w >= 225 && s.r >= 5);
        }
      }

      document.getElementById('est1rm').textContent = (est1RM == null) ? '—' : String(est1RM);

      const m200 = document.getElementById('m200');
      const m225 = document.getElementById('m225');

      m200.textContent = hit200 ? 'Hit' : 'Not yet';
      m225.textContent = hit225 ? 'Hit' : 'Not yet';

      m200.className = 'right ' + (hit200 ? 'ok' : 'no');
      m225.className = 'right ' + (hit225 ? 'ok' : 'no');

      setStatus('Imported ✓', 'good');
    } catch(e){
      setStatus('Import failed', 'bad');
    }
  }

  function loadSample() {
    document.getElementById('input').value =
`@day 2026-02-21
weight: 182.0
calories: 2100
protein: 155

@run
type: easy
distance_mi: 3.5
duration: 38:00
avg_pace: 10:51
avg_hr: 153

@lift
bench_press: 200x5, 185x8, 175x10
seated_row: 140x10, 140x9
leg_press: 285x12, 305x8
ez_bar_curl: 60x10, 60x9`;
  }
</script>

</body>
</html>
