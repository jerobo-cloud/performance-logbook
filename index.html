<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Performance Logbook</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<style>
  :root {
    --bg: #0b0f14;
    --card: #151a21;
    --muted: #9aa4b2;
    --text: #e6edf3;
    --accent: #3b82f6;
    --success: #22c55e;
    --radius: 14px;
  }

  * { box-sizing: border-box; }
  body {
    margin: 0;
    font-family: -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
    background: var(--bg);
    color: var(--text);
    padding: 16px;
  }

  h1 { font-size: 26px; margin-bottom: 6px; }
  h2 { font-size: 18px; margin: 0 0 10px; }

  .card {
    background: linear-gradient(180deg, #1a2029, var(--card));
    border-radius: var(--radius);
    padding: 14px;
    margin-bottom: 14px;
  }

  textarea {
    width: 100%;
    min-height: 140px;
    background: #0f1520;
    color: var(--text);
    border: 1px solid #253042;
    border-radius: 10px;
    padding: 10px;
    font-family: ui-monospace, monospace;
    font-size: 14px;
  }

  button {
    background: var(--accent);
    color: white;
    border: none;
    border-radius: 10px;
    padding: 10px 14px;
    font-weight: 600;
    margin-right: 8px;
  }

  button.secondary {
    background: #253042;
  }

  .muted { color: var(--muted); font-size: 13px; }
  .success { color: var(--success); font-weight: 600; }

  .row {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 10px;
  }

  .stat {
    background: #1d2430;
    border-radius: 12px;
    padding: 12px;
    text-align: center;
  }

  .stat .value { font-size: 22px; font-weight: 700; }
  .stat .label { font-size: 12px; color: var(--muted); }

  .chip {
    background: #1d2430;
    border-radius: 999px;
    padding: 8px 12px;
    margin-top: 8px;
    font-size: 14px;
  }

  .collapsed { display: none; }
</style>
</head>

<body>

<h1>Performance Logbook</h1>
<div class="muted">Paste nightly snapshot, import, review today & trends.</div>

<!-- IMPORT -->
<div class="card" id="importCard">
  <h2>Import</h2>
  <textarea id="input"></textarea>
  <div style="margin-top:10px">
    <button onclick="importSnapshot()">Import</button>
    <button class="secondary" onclick="loadSample()">Load sample</button>
    <span id="importStatus" class="success"></span>
  </div>
  <div class="muted" style="margin-top:6px">
    Tip: use <code>na</code> for missing values. Bench milestones require <b>5+ reps</b>.
  </div>
</div>

<!-- TODAY -->
<div class="card">
  <h2>Today <span class="muted" id="todayDate"></span></h2>

  <div class="row">
    <div class="stat">
      <div class="value" id="w">—</div>
      <div class="label">Weight (lbs)</div>
    </div>
    <div class="stat">
      <div class="value" id="c">—</div>
      <div class="label">Calories</div>
    </div>
    <div class="stat">
      <div class="value" id="p">—</div>
      <div class="label">Protein (g)</div>
    </div>
  </div>

  <div class="chip" id="runChip"></div>
  <div class="chip" id="liftChip"></div>
</div>

<!-- TRENDS (placeholder) -->
<div class="card">
  <h2>Trends</h2>
  <div class="muted">Weight, aerobic pace, and bench 1RM trends coming next.</div>
</div>

<!-- RUN GOALS -->
<div class="card">
  <h2>Run Goals</h2>
  <div class="muted">
    Avg pace ≤ goal pace <br>
    Avg HR ≤ 160
  </div>
  <div class="chip">Goal 1: 9:30 /mi</div>
  <div class="chip">Goal 2: 9:00 /mi</div>
</div>

<!-- LIFT GOALS -->
<div class="card">
  <h2>Bench Goals</h2>
  <div class="chip" id="benchGoals"></div>
</div>

<script>
let data = {};

function epley(w, r) {
  return Math.round(w * (1 + r / 30));
}

function importSnapshot() {
  const lines = document.getElementById('input').value
    .split('\n')
    .map(l => l.trim())
    .filter(Boolean);

  let section = null;
  data = { day:{}, run:{}, lift:{} };

  for (const line of lines) {
    if (line.startsWith('@')) {
      section = line.slice(1).trim().split(/\s+/)[0];
      continue;
    }

    const [k, v] = line.split(':').map(x => x.trim());
    if (!k || v === undefined) continue;
    data[section][k] = v;
  }

  render();
  document.getElementById('importStatus').textContent = 'Imported ✓';
  document.getElementById('importCard').classList.add('collapsed');
}

function render() {
  document.getElementById('todayDate').textContent = data.day?.date || '';
  document.getElementById('w').textContent = data.day?.weight ?? '—';
  document.getElementById('c').textContent = data.day?.calories ?? '—';
  document.getElementById('p').textContent = data.day?.protein ?? '—';

  if (data.run?.avg_pace) {
    document.getElementById('runChip').textContent =
      `Run · ${data.run.type} · ${data.run.distance_mi} mi · pace ${data.run.avg_pace} · HR ${data.run.avg_hr}`;
  }

  if (data.lift?.bench_press) {
    const [w, r] = data.lift.bench_press.split('x').map(Number);
    const est = epley(w, r);
    const hit200 = w >= 200 && r >= 5;
    const hit225 = w >= 225 && r >= 5;

    document.getElementById('liftChip').textContent =
      `Lift · bench_press`;

    document.getElementById('benchGoals').textContent =
      `Estimated 1RM: ${est} · 200×5+: ${hit200} · 225×5+: ${hit225}`;
  }
}

function loadSample() {
  document.getElementById('input').value =
`@day 2026-02-21
weight: 182.0
calories: 2100
protein: 155

@run
type: easy
distance_mi: 3.5
duration: 38:00
avg_pace: 10:51
avg_hr: 153

@lift
bench_press: 200x5`;
}
</script>

</body>
</html>
